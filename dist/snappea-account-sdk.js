!function(a){var b=window.$.Deferred,c=window.$.ajax;$.ajaxSetup&&$.ajaxSetup({xhrFields:{withCredentials:!0}});var d,e=function(a,b){if(!b)return a;var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},f="https://account.wandoujia.com",g="http://www.wandoujia.com/api/account",h="/v4/api",i=navigator.userAgent.toLowerCase().indexOf("msie")>-1,j=(i?g:f)+h,k={login:j+"/login",logout:j+"/logout",captcha:j+"/seccode",reg:j+"/register",checkUsername:j+"/isUsernameExisted",checkUserLogin:j+"/profile",findPwd:j+"/findpassword",checkCode:j+"/checkcode",resetPwd:j+"/resetpassword",modifyPwd:j+"/profile/password",checkPasscode:j+"/checkpasscode",modifyPwdByCode:j+"/modifypassword",completeProfile:j+"/completeProfile",activate:j+"/activation/initialization",activateValid:j+"/activation/validation",unbindThirdParty:j+"/social/unbind",avatar:j+"/avatar",confirm:j+"/account/confirm"},l={loginWithThirdParty:f+"/web/oauth2/{1}/login"},m=!1,n={};n.CAPTCHA=k.captcha,n.loginAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&a.password?c({type:"POST",dataType:"json",url:k.login,data:e({username:a.username,password:a.password,seccode:a.seccode||""},f),success:function(a){0===a.error?(m=!0,d=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}):g.reject({error:-2,msg:"参数不全"}),g.promise()},n.isLogined=function(){return m},n.getUserInfo=function(){return d},n.logoutAsync=function(a){var e=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"POST",dataType:f?"jsonp":"json",url:k.logout,data:a,crossDomain:f?!0:void 0,success:function(a){0===a.error?(m=!1,d=void 0,e.resolve(a)):e.reject(a)},error:function(a){4===a.readyState&&e.reject(a.responseJSON),e.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),e.promise()},n.regAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&(a.oneKeyRegister||a.password)?c({type:"POST",dataType:"json",url:k.reg,data:e({username:a.username,password:a.password,oneKeyRegister:a.oneKeyRegister||!1,nick:a.nickname||"",seccode:a.seccode||""},f),success:function(a){0===a.error?(m=!0,d=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}):g.reject({error:-2,msg:"参数不全"}),g.promise()},n.checkUsernameAsync=function(a,d){var f=new b;return d=d||{},void 0===a?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.checkUsername,data:e({username:a},d),success:function(a){f.resolve(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.checkUserLoginAsync=function(a){var e=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:f?"jsonp":"json",url:k.checkUserLogin,data:a,crossDomain:f?!0:void 0,success:function(a){0===a.error?(m=!0,d=a.member,e.resolve(!0)):(m=!1,d=void 0,e.reject(!1))},error:function(){e.reject(!1)}}),e.promise()},n.findPwdAsync=function(a,d){var f=new b;return d=d||{},void 0===a?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.findPwd,data:e({username:a},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.checkCodeAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.username||void 0===a.passcode?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.checkCode,data:e({username:a.username,passcode:a.passcode},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.resetPwdAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.username||void 0===a.passcode||void 0===a.password?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.resetPwd,data:e({username:a.username,passcode:a.passcode,password:a.password,repeatedpassword:a.password},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.modifyPwdAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.password||void 0===a.newpassword?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.modifyPwd,data:e({oldpassword:a.password,newpassword:a.newpassword},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.checkPasscodeAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.passcode?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.checkPasscode,data:e({passcode:a.passcode},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.modifyPwdByCodeAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.passcode||void 0===a.password?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.modifyPwdByCode,data:e({passcode:a.passcode,password:a.password},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.updateProfileAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.nickname?g.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.completeProfile,data:e({nick:a.nickname},f),success:function(a){0===a.error?(d=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),g.promise()},n.activateAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.type?f.reject({error:-2,msg:"参数不全"}):c({type:"GET",dataType:"json",url:k.activate,data:e({type:a.type},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.activateValidAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.code?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.activateValid,data:e({code:a.code,type:"sms"},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.uploadAvatarAsync=function(e,f){var g=new b;e=e||{},f=f||{};var h,i;if(void 0===e.file)g.reject({error:-2,msg:"参数不全"});else{h=new a.FormData,h.append("file",e.file);for(i in f)f.hasOwnProperty(i)&&h.append(i,f[i]);c({type:"POST",dataType:"json",url:k.avatar,data:h,processData:!1,contentType:!1,success:function(a){0===a.error?(d=a.member,g.resolve(a.member.avatar)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}})}return g.promise()},n.unbindThirdPartyAsync=function(a,d){var f=new b;a=a||{},d=d||{};var g={weibo:"1",sina:"1",qq:"2",renren:"3"};return void 0===a.platform||void 0===g[a.platform]?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.unbindThirdParty,data:e({platid:g[a.platform]},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.confirmAsync=function(a,d){var f=new b;return a=a||{},d=d||{},void 0===a.code?f.reject({error:-2,msg:"参数不全"}):c({type:"POST",dataType:"json",url:k.confirm,data:e({code:a.code},d),success:function(a){0===a.error?f.resolve(a):f.reject(a)},error:function(a){4===a.readyState&&f.reject(a.responseJSON),f.reject({error:-1,msg:"请求失败，请检查网络连接状况。"})}}),f.promise()},n.isEmail=function(a){var b=/^\s*?(.+)@(.+?)\.(.+?)\s*$/;return b.test(a)},n.isPhoneNumber=function(a){var b=/^(1(([3548][\d])))\d{8}$/;return b.test(a)},n.loginWithThirdParty=function(b){b=b||{},b.callback=b.callback||"http://www.wandoujia.com/";var c={weibo:"sina",sina:"sina",renren:"renren",qq:"qq"},d=c[b.platform];delete b.platform;var e=b.onclose||function(){};delete b.onclose;var f,g=[];for(f in b)b.hasOwnProperty(f)&&g.push(f+"="+a.encodeURIComponent(b[f]));var h=l.loginWithThirdParty.replace("{1}",d);if(g.length>0&&(h=h+"?"+g.join("&")),b.popup)var i=window.open(h,"loginWithThirdParty","width=650, height=480"),j=setInterval(function(){i.closed&&(clearInterval(j),e.call(this))},200);else a.location.href=h};var o=a.SnapPea||{};o.Account=n,a.SnapPea=o}(this);