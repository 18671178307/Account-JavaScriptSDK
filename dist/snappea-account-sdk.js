!function(a){var b=window.$.Deferred,c=window.$.ajax;$.ajaxSetup&&$.ajaxSetup({xhrFields:{withCredentials:!0}});var d,e=function(a,b){if(!b)return a;var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},f={ajax:{error:-1,msg:"请求失败，请检查网络连接状况。"},missingParameters:{error:-2,msg:"参数不全"}},g="https://account.wandoujia.com",h="http://www.wandoujia.com/api/account",i="/v4/api",j=navigator.userAgent.toLowerCase().indexOf("msie")>-1,k=(j?h:g)+i,l={login:k+"/login",logout:k+"/logout",captcha:k+"/seccode",reg:k+"/register",checkUsername:k+"/isUsernameExisted",checkUserLogin:k+"/profile",findPwd:k+"/findpassword",checkCode:k+"/checkcode",resetPwd:k+"/resetpassword",modifyPwd:k+"/profile/password",checkPasscode:k+"/checkpasscode",modifyPwdByCode:k+"/modifypassword",completeProfile:k+"/completeProfile",activate:k+"/activation/initialization",activateValid:k+"/activation/validation",unbindThirdParty:k+"/social/unbind",avatar:k+"/avatar",confirm:k+"/account/confirm"},m={loginWithThirdParty:g+"/web/oauth2/{1}/login"},n=!1,o={};o.CAPTCHA=l.captcha,o.loginAsync=function(a,g){var h=new b;return a=a||{},g=g||{},a.username&&a.password?c({type:"POST",dataType:"json",url:l.login,data:e({username:a.username,password:a.password,seccode:a.seccode||""},g),success:function(a){0===a.error?(n=!0,d=a.member,h.resolve(a.member)):h.reject(a)},error:function(a){4===a.readyState&&h.reject(a.responseJSON),h.reject(f.ajax)}}):h.reject(f.missingParameters),h.promise()},o.isLogined=function(){return n},o.getUserInfo=function(){return d},o.logoutAsync=function(a){var e=new b;a=a||{};var g=!!a.jsonp;return delete a.jsonp,c({type:"POST",dataType:g?"jsonp":"json",url:l.logout,data:a,crossDomain:g?!0:void 0,success:function(a){0===a.error?(n=!1,d=void 0,e.resolve(a)):e.reject(a)},error:function(a){4===a.readyState&&e.reject(a.responseJSON),e.reject(f.ajax)}}),e.promise()},o.regAsync=function(a,g){var h=new b;return a=a||{},g=g||{},a.username&&(a.oneKeyRegister||a.password)?c({type:"POST",dataType:"json",url:l.reg,data:e({username:a.username,password:a.password,oneKeyRegister:a.oneKeyRegister||!1,nick:a.nickname||"",seccode:a.seccode||""},g),success:function(a){0===a.error?(n=!0,d=a.member,h.resolve(a.member)):h.reject(a)},error:function(a){4===a.readyState&&h.reject(a.responseJSON),h.reject(f.ajax)}}):h.reject(f.missingParameters),h.promise()},o.checkUsernameAsync=function(a,d){var g=new b;return d=d||{},void 0===a?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.checkUsername,data:e({username:a},d),success:function(a){g.resolve(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.checkUserLoginAsync=function(a){var e=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:f?"jsonp":"json",url:l.checkUserLogin,data:a,crossDomain:f?!0:void 0,success:function(a){0===a.error?(n=!0,d=a.member,e.resolve(!0)):(n=!1,d=void 0,e.reject(!1))},error:function(){e.reject(!1)}}),e.promise()},o.findPwdAsync=function(a,d){var g=new b;return d=d||{},void 0===a?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.findPwd,data:e({username:a},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.checkCodeAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.username||void 0===a.passcode?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.checkCode,data:e({username:a.username,passcode:a.passcode},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.resetPwdAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.username||void 0===a.passcode||void 0===a.password?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.resetPwd,data:e({username:a.username,passcode:a.passcode,password:a.password,repeatedpassword:a.password},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.modifyPwdAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.password||void 0===a.newpassword?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.modifyPwd,data:e({oldpassword:a.password,newpassword:a.newpassword},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.checkPasscodeAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.passcode?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.checkPasscode,data:e({passcode:a.passcode},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.modifyPwdByCodeAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.passcode||void 0===a.password?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.modifyPwdByCode,data:e({passcode:a.passcode,password:a.password},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.updateProfileAsync=function(a,g){var h=new b;return a=a||{},g=g||{},void 0===a.nickname?h.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.completeProfile,data:e({nick:a.nickname},g),success:function(a){0===a.error?(d=a.member,h.resolve(a.member)):h.reject(a)},error:function(a){4===a.readyState&&h.reject(a.responseJSON),h.reject(f.ajax)}}),h.promise()},o.activateAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.type?g.reject(f.missingParameters):c({type:"GET",dataType:"json",url:l.activate,data:e({type:a.type},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.activateValidAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.code?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.activateValid,data:e({code:a.code,type:"sms"},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.uploadAvatarAsync=function(e,g){var h=new b;e=e||{},g=g||{};var i,j;if(void 0===e.file)h.reject(f.missingParameters);else{i=new a.FormData,i.append("file",e.file);for(j in g)g.hasOwnProperty(j)&&i.append(j,g[j]);c({type:"POST",dataType:"json",url:l.avatar,data:i,processData:!1,contentType:!1,success:function(a){0===a.error?(d=a.member,h.resolve(a.member.avatar)):h.reject(a)},error:function(a){4===a.readyState&&h.reject(a.responseJSON),h.reject(f.ajax)}})}return h.promise()},o.unbindThirdPartyAsync=function(a,d){var g=new b;a=a||{},d=d||{};var h={weibo:"1",sina:"1",qq:"2",renren:"3"};return void 0===a.platform||void 0===h[a.platform]?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.unbindThirdParty,data:e({platid:h[a.platform]},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.confirmAsync=function(a,d){var g=new b;return a=a||{},d=d||{},void 0===a.code?g.reject(f.missingParameters):c({type:"POST",dataType:"json",url:l.confirm,data:e({code:a.code},d),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON),g.reject(f.ajax)}}),g.promise()},o.isEmail=function(a){var b=/^\s*?(.+)@(.+?)\.(.+?)\s*$/;return b.test(a)},o.isPhoneNumber=function(a){var b=/^(1(([3548][\d])))\d{8}$/;return b.test(a)},o.loginWithThirdParty=function(b){b=b||{},b.callback=b.callback||"http://www.wandoujia.com/";var c={weibo:"sina",sina:"sina",renren:"renren",qq:"qq"},d=c[b.platform];delete b.platform;var e=b.onclose||function(){};delete b.onclose;var f,g=[];for(f in b)b.hasOwnProperty(f)&&g.push(f+"="+a.encodeURIComponent(b[f]));var h=m.loginWithThirdParty.replace("{1}",d);if(g.length>0&&(h=h+"?"+g.join("&")),b.popup)var i=window.open(h,"loginWithThirdParty","width=650, height=480"),j=setInterval(function(){i.closed&&(clearInterval(j),e.call(this))},200);else a.location.href=h};var p=a.SnapPea||{};p.Account=o,a.SnapPea=p}(this);